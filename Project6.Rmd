---
title: "Corona virus"
---

A coronavirus causing a disease called COVID-19 has affected this world in 2020. The infection spread globally and was declared a pandemic.
Several countries have decided to take unprecedented and severe precautions to prevent the spread of this virus.
Among these are social distancing and lockdowns. Here, I vizualize data provided by [Google](https://www.google.com/covid19/mobility/) on the mobility changes in various countries and [data](https://github.com/owid/covid-19-data) on the number of deaths of people infected with the novel coronavirus.



```{r setup, echo=FALSE,include=FALSE,warning = FALSE}
rm(list = ls())
#library(libwgeom)
#install.packages("googleway")
library(googleway)
library(purrr)
library(sf)
library(cowplot)
#install.packages("ggspatial")
library(ggspatial)
#install.packages("rnaturalearth")
#install.packages("rnaturalearthdata")
library(rnaturalearth)
library(rnaturalearthdata)
library(cowplot)

#install.packages('rgeos')
library(rgeos)
#install.packages('tools')
library(tools)
#install.packages("ggiraph")
library(ggiraph)
library(ggrepel)
#install.packages("maps")
library(maps)
library(plyr)
library(dplyr)
library(httr)
library(rvest)


```

I selected 6 countries as examples for different areas of the world and different economic capabilities.
The data shows for the selected countries a drop in mobility to between 40-60% of normal mobility to public places such as parks and retail.
This data also shows that economically weaker countries (South Africa, Philippines, Brazil, India) are affected much more by the coronavirus. The lockdown was overall more severe, and the total number of deaths is still increasing.
Further, it is interesting to note that the trend to return to normal mobility appears to be slowing down (except for Germany). In the USA, the mobility even appears to decrease againg, likely caused by new lockdowns in various counties across the country.
```{r box1, echo=FALSE,warning = FALSE,include=FALSE}

library(rvest)
library(httr)
library(XML)
library(xml2)
library(ggplot2)
library(ggiraph)
download.file('https://www.gstatic.com/covid19/mobility/Global_Mobility_Report.csv?',
                                          destfile = paste0("~/Google Drive/covid/Global_Mobility_Report2_",Sys.Date(),"_.csv") )
#Google
#Global_Mobility_Report <- read.csv('Global_Mobility_Report2.csv')
Global_Mobility_Report <- read.csv(paste0("~/Google Drive/covid/Global_Mobility_Report2_",Sys.Date(),"_.csv"))
#Apple
#applemobilitytrends <- read.csv('applemobilitytrends-2020-06-05.csv')

download.file('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/owid-covid-data.csv',
              destfile = paste0("~/Google Drive/covid/covid_cases_",Sys.Date(),"_.csv") )
#covid_cases <- read.csv('covid_cases.csv')  
covid_cases <- read.csv(paste0("~/Google Drive/covid/covid_cases_",Sys.Date(),"_.csv"))  

download.file('https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/testing/covid-testing-all-observations.csv',
              destfile = paste0("~/Google Drive/covid/covid_testing_",Sys.Date(),"_.csv") )
#covid_testing <- read.csv('covid_testing.csv') 
covid_testing <- read.csv(paste0("~/Google Drive/covid/covid_testing_",Sys.Date(),"_.csv")) 

covid_cases$date <- as.Date(covid_cases$date, format="%Y-%m-%d")
#write.csv(covid_cases,'covid_cases.csv')
covid_cases1 <- subset(covid_cases, ! location=='International' & !location=='World'& !date=='2020-06-07')
covid_cases2 <- aggregate(x= covid_cases1$total_cases, 
                            by = list( 
                              'continent'=covid_cases1$continent,
                              'date'=covid_cases1$date
                            #  'condition'=all_reps_step$condition
                            ), FUN = sum)



#unique(Global_Mobility_Report$country_region)
countries <- c('South Africa','Germany','Brazil','Philippines','United States','India')

Global_Mobility_Report1_ <- NULL
for (i in seq_along(countries)) {
  Global_Mobility_Report1 <- subset(Global_Mobility_Report, country_region==countries[i])
  Global_Mobility_Report1_ <- rbind.fill(Global_Mobility_Report1_,Global_Mobility_Report1)
}
#Global_Mobility_Report1 <- subset(Global_Mobility_Report, country_region==countries)

Global_Mobility_Report2 <- subset(Global_Mobility_Report1_, sub_region_1=='')
colnames(Global_Mobility_Report2)
Global_Mobility_Report2$date <- as.Date(Global_Mobility_Report2$date, format="%Y-%m-%d")

covid_cases3 <- subset(covid_cases,  location==countries)

Global_Mobility_Report2$value <- Global_Mobility_Report2$retail_and_recreation_percent_change_from_baseline+100
Global_Mobility_Report2$value <- Global_Mobility_Report2$workplaces_percent_change_from_baseline+100
Global_Mobility_Report2$country <- Global_Mobility_Report2$country_region
Global_Mobility_Report2$group <- 'mobility'

covid_cases4 <- NULL
for (i in seq_along(countries)) {
  covid_cases3_1 <- subset(covid_cases3, location==countries[i])
 # top <- max(covid_cases3_1$total_deaths_per_million,na.rm = T)
  top <- max(covid_cases3_1$total_deaths,na.rm = T)
  covid_cases3_1$rel_deaths <- 100*covid_cases3_1$total_deaths/top
  covid_cases4 <- rbind.fill(covid_cases4,covid_cases3_1)
}

covid_cases4$value <- covid_cases4$rel_deaths
covid_cases4$country <- covid_cases4$location
#covid_cases4$date <- covid_cases4$date
covid_cases4$group <- 'COVID-19 Deaths'

rel_death_mobility <- rbind.fill(Global_Mobility_Report2,covid_cases4)



p15 <- ggplot(rel_death_mobility, aes(x = date, y = value, color=group))+
  geom_line(alpha=0.4) + ylab('relative change') + xlab('')+
  ggtitle('Comparing mobility changes in retail and recreation\n to Deaths of people diagnosed with COVID-19')+
  facet_wrap(~country)+
  geom_smooth()+
  scale_color_manual(values = c('black','red'))+
  ggthemes::theme_economist()+
  theme(legend.title = element_blank())


```

```{r plotbox, echo=FALSE,warning = FALSE,comment=F,message=F}
print(p15)
```
